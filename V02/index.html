<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>MyCar — Dashboard</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="css/settings-modal.css" />
    <meta name="theme-color" content="#0f172a" />
  </head>
  <body>
    <header class="topbar">
      <div class="brand">MyCar • Personal Manager</div>
      <div class="top-actions">
        <button id="btnExport" class="btn">Export JSON</button>
        <label class="btn file-btn"
          >Import <input id="importFile" type="file" accept="application/json"
        /></label>
        <button id="btnSettings" class="btn">Settings</button>
      </div>
    </header>

    <nav class="tabs" id="tabs">
      <button class="tab active" data-page="dashboard">Dashboard</button>
      <button class="tab" data-page="car-savings">Car Savings</button>
      <button class="tab" data-page="maintenance">Maintenance</button>
      <button class="tab" data-page="fuel">Fuel</button>
      <button class="tab" data-page="reports">Reports</button>
      <button class="tab" data-page="parts">Parts</button>
      <button class="tab" data-page="suppliers">Suppliers</button>
    </nav>

    <main class="container">
      <!-- DASHBOARD (default) -->
      <section id="dashboard" class="page active">
        <div class="page-head">
          <h1>Dashboard</h1>
          <div class="quick-actions">
            <button class="btn green" data-action="open-add" data-type="car-savings">
              + Car Savings
            </button>
            <button class="btn green" data-action="open-add" data-type="maintenance">
              + Maintenance
            </button>
            <button class="btn green" data-action="open-add" data-type="fuel">
              + Fuel
            </button>
          </div>
        </div>

        <!-- Summary Cards -->
        <div class="cards" id="dashCards"></div>

        <div class="dashboard-grid">
          <!-- Left Column -->
          <div class="dashboard-col">
            <div class="panel">
              <h3>Recent Activity</h3>
              <div id="recentList" class="list"></div>
            </div>

            <div class="panel">
              <h3>Monthly Expenses</h3>
              <div class="chart-container">
                <canvas id="expensesChart"></canvas>
              </div>
            </div>
          </div>

          <!-- Right Column -->
          <div class="dashboard-col">
            <div class="panel">
              <h3>Upcoming Services</h3>
              <div id="upcomingServices" class="list"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- REPORTS -->
      <section id="reports" class="page">
        <div class="page-head">
          <h1>Reports</h1>
        </div>

        <!-- Savings Report -->
        <div id="savingsReport" class="report-section">
          <h2>Car Savings Report</h2>
          
          <form class="report-filters">
            <div class="filter-group">
              <div class="filter-item">
                <label>Start Date</label>
                <input type="date" name="startDate">
              </div>
              <div class="filter-item">
                <label>End Date</label>
                <input type="date" name="endDate">
              </div>
              <div class="filter-actions">
                <button type="submit" class="btn">Apply Filters</button>
                <button type="button" class="btn reset-filters">Reset</button>
              </div>
            </div>
          </form>

          <div class="report-summary"></div>
          <div class="report-table"></div>
        </div>

        <!-- Fuel Report -->
        <div id="fuelReport" class="report-section">
          <h2>Fuel Report</h2>
          
          <form class="report-filters">
            <div class="filter-group">
              <div class="filter-item">
                <label>Start Date</label>
                <input type="date" name="startDate">
              </div>
              <div class="filter-item">
                <label>End Date</label>
                <input type="date" name="endDate">
              </div>
              <div class="filter-item">
                <label>Min Price/L</label>
                <input type="number" name="minPrice" step="0.01">
              </div>
              <div class="filter-item">
                <label>Max Price/L</label>
                <input type="number" name="maxPrice" step="0.01">
              </div>
              <div class="filter-actions">
                <button type="submit" class="btn">Apply Filters</button>
                <button type="button" class="btn reset-filters">Reset</button>
              </div>
            </div>
          </form>

          <div class="report-summary"></div>
          <div class="report-table"></div>
        </div>

        <!-- Maintenance Report -->
        <div id="maintenanceReport" class="report-section">
          <h2>Maintenance Report</h2>
          
          <form class="report-filters">
            <div class="filter-group">
              <div class="filter-item">
                <label>Start Date</label>
                <input type="date" name="startDate">
              </div>
              <div class="filter-item">
                <label>End Date</label>
                <input type="date" name="endDate">
              </div>
              <div class="filter-item">
                <label>Supplier</label>
                <input type="text" name="supplier" placeholder="Filter by supplier">
              </div>
              <div class="filter-item">
                <label>Service Type</label>
                <input type="text" name="serviceType" placeholder="Filter by service">
              </div>
              <div class="filter-actions">
                <button type="submit" class="btn">Apply Filters</button>
                <button type="button" class="btn reset-filters">Reset</button>
              </div>
            </div>
          </form>

          <div class="report-summary"></div>
          <div class="report-table"></div>
        </div>
      </section>

      <!-- CAR SAVINGS -->
      <!-- FUEL LOG -->
      <!-- MAINTENANCE -->
      <section id="maintenance" class="page">
        <div class="page-head">
          <h1>Maintenance Records</h1>
        </div>

        <div class="panel">
          <h3>Add New Maintenance Record</h3>
          <form id="maintenanceForm" class="form">
            <div class="form-group">
              <label>Date</label>
              <input type="date" id="maintenanceDate" required>
            </div>
            <div class="form-group">
              <label>Odometer Reading (km)</label>
              <input type="number" id="maintenanceOdometer" required>
            </div>
            <div class="form-group">
              <label>Supplier Name</label>
              <input type="text" id="supplierName" required>
            </div>
            <div class="form-group">
              <label>Supplier Location</label>
              <input type="text" id="supplierLocation" required 
                     placeholder="Enter address for Google Maps link">
            </div>

            <h4>Services</h4>
            <div id="servicesList" class="services-list"></div>
            <button type="button" id="addService" class="btn">Add Service</button>

            <div class="total-container">
              Total Cost: <span id="totalCost">$0.00</span>
            </div>

            <div class="form-actions">
              <button type="submit" class="btn green">Save Maintenance Record</button>
            </div>
          </form>
        </div>

        <div class="panel">
          <h3>Maintenance History</h3>
          <div id="maintenanceRecords" class="list"></div>
        </div>
      </section>

      <section id="fuel" class="page">
        <div class="page-head">
          <h1>Fuel Log</h1>
        </div>

        <div class="panel">
          <h3>Add New Fuel Entry</h3>
          <form id="fuelForm" class="form">
            <div class="form-group">
              <label>Amount Spent ($)</label>
              <input type="number" id="fuelAmount" step="0.01" required>
            </div>
            <div class="form-group">
              <label>Price per Liter ($)</label>
              <input type="number" id="fuelPrice" step="0.01" required>
            </div>
            <div class="form-group">
              <label>Odometer Reading (km)</label>
              <input type="number" id="fuelOdometer" required>
            </div>
            <div class="form-group">
              <label>Calculated Liters:</label>
              <strong id="calculatedLiters">0 L</strong>
            </div>
            <div class="form-actions">
              <button type="submit" class="btn green">Add Fuel Log</button>
            </div>
          </form>
        </div>

        <div class="panel">
          <h3>Fuel History</h3>
          <div id="fuelStats" class="stats-panel"></div>
          <div id="fuelList" class="list"></div>
        </div>
      </section>

      <section id="car-savings" class="page">
        <div class="page-head">
          <h1>Car Savings Tracker</h1>
          <button class="btn green" data-action="open-add" data-type="car-savings">
            Add Savings Entry
          </button>
        </div>

        <div class="panel">
          <div class="car-savings-summary" id="carSavingsSummaryCard">
            <h3>Total Car Savings</h3>
            <div class="summary-stats">
              <div class="stat">
                <span class="label">Total Saved:</span>
                <span class="value" id="totalCarSaved">EGP 0.00</span>
              </div>
              <div class="stat">
                <span class="label">Last Updated:</span>
                <span class="value" id="lastCarUpdated">Never</span>
              </div>
              <div class="stat">
                <span class="label">Entries:</span>
                <span class="value" id="carEntryCount">0</span>
              </div>
              <div class="stat">
                <span class="label">Goal Progress:</span>
                <span class="value" id="goalProgress">0%</span>
              </div>
            </div>
            <div class="goal-input" style="margin-top: 16px;">
              <label for="carGoalAmount">Set Car Goal (EGP):</label>
              <div style="display: flex; gap: 8px; align-items: center;">
                <input id="carGoalAmount" type="number" min="0" step="0.01" placeholder="Enter target amount" style="flex: 1;" />
                <button id="btnSetGoal" class="btn">Set Goal</button>
              </div>
            </div>
          </div>
        </div>

        <div class="panel">
          <h3>Add New Savings Entry</h3>
          <form id="carSavingsForm" class="form-grid">
            <div>
              <label>Date</label>
              <input id="carSavDate" type="date" required />
            </div>
            <div>
              <label>Amount (EGP)</label>
              <input id="carSavAmount" type="number" min="0" step="0.01" required />
            </div>
            <div style="grid-column: 1/-1;">
              <label>Description</label>
              <input id="carSavDescription" type="text" placeholder="e.g., Monthly Income, Side Job, Gift, Bonus" required />
            </div>
            <div style="grid-column: 1/-1;">
              <label>Notes (Optional)</label>
              <textarea id="carSavNotes" placeholder="Additional details about this savings entry..."></textarea>
            </div>
            <div class="form-actions" style="grid-column: 1/-1">
              <button class="btn green" type="submit">Add Savings</button>
              <button class="btn red" id="btnClearCarSavings" type="button">
                Clear All
              </button>
            </div>
          </form>
        </div>

        <div class="panel">
          <h3>Savings History</h3>
          <table class="table" id="carSavingsTable">
            <thead>
              <tr>
                <th>Date</th>
                <th>Amount</th>
                <th>Description</th>
                <th>Notes</th>
                <th>Running Total</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="panel">
          <h3>Savings Breakdown by Source</h3>
          <div id="savingsBreakdown" class="breakdown-chart">
            <canvas id="savingsPieChart" width="400" height="300"></canvas>
          </div>
        </div>
      </section>

      <!-- MAINTENANCE -->
      <section id="maintenance" class="page">
        <div class="page-head">
          <h1>Maintenance</h1>
          <button
            class="btn green"
            data-action="open-add"
            data-type="maintenance"
          >
            Add Maintenance
          </button>
        </div>

        <div class="panel">
          <table class="table" id="maintTable">
            <thead>
              <tr>
                <th>Date</th>
                <th>Odo</th>
                <th>Type</th>
                <th>Services</th>
                <th>Total Cost</th>
                <th>Supplier</th>
                <th>Next Service</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- FUEL -->
      <section id="fuel" class="page">
        <div class="page-head">
          <h1>Fuel</h1>
          <button class="btn green" data-action="open-add" data-type="fuel">
            Add Fuel
          </button>
        </div>

        <div class="panel">
          <div class="fuel-summary" id="fuelSummaryCard">
            <h3>Fuel Efficiency</h3>
            <div class="summary-stats">
              <div class="stat">
                <span class="label">Average km/L:</span>
                <span class="value" id="avgKmL">-</span>
              </div>
              <div class="stat">
                <span class="label">Average L/100km:</span>
                <span class="value" id="avgL100km">-</span>
              </div>
              <div class="stat">
                <span class="label">Total Spent:</span>
                <span class="value" id="totalFuelSpent">EGP 0.00</span>
              </div>
            </div>
          </div>
        </div>

        <div class="panel">
          <table class="table" id="fuelTable">
            <thead>
              <tr>
                <th>Date</th>
                <th>Odo</th>
                <th>Liters</th>
                <th>Price/L</th>
                <th>Total</th>
                <th>km/L</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- PARTS -->
      <section id="parts" class="page">
        <div class="page-head">
          <h1>Parts</h1>
          <button class="btn green" data-action="open-add" data-type="part">
            Add Part
          </button>
        </div>

        <div class="panel">
          <table class="table" id="partTable">
            <thead>
              <tr>
                <th>SKU</th>
                <th>Name</th>
                <th>Price</th>
                <th>Supplier</th>
                <th>Warranty (mo)</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- SUPPLIERS -->
      <section id="suppliers" class="page">
        <div class="page-head">
          <h1>Suppliers</h1>
          <button class="btn green" data-action="open-add" data-type="supplier">
            Add Supplier
          </button>
        </div>

        <div class="panel">
          <table class="table" id="supplierTable">
            <thead>
              <tr>
                <th>Name</th>
                <th>Phone</th>
                <th>Location</th>
                <th>Rating</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>
    </main>

    <!-- Side panel for slide-in forms -->
    <aside id="sidePanel" class="side-panel" aria-hidden="true">
      <div class="side-header">
        <h3 id="sideTitle">Add</h3>
        <button id="sideClose" class="small-btn">Close</button>
      </div>
      <div id="sideContent" class="side-content"></div>
    </aside>

    <!-- Settings content (used in side panel) -->
    <template id="settingsTemplate">
      <div class="panel">
        <h3>Settings</h3>
        <div style="display: grid; gap: 8px">
          <label
            >Fuel unit:
            <select id="fuelUnit">
              <option value="kmpl">km/L</option>
              <option value="l100km">L/100km</option>
            </select>
          </label>
          <button id="resetApp" class="btn red">
            Reset Application (clear all)
          </button>
        </div>
      </div>
    </template>

    <script src="db.js"></script>
    <script src="charts.js"></script>
    <script src="fuel-log.js"></script>
    <script src="maintenance.js"></script>
    <script src="dashboard.js"></script>
    <script src="reminder-system.js"></script>
    <script src="reports.js"></script>
    <script src="js/data-manager.js"></script>
    <script src="js/settings.js"></script>
    <script src="app.js"></script>
  </body>
</html>
