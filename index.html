<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Car Maintenance Tracker</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <header>
    <h1>Maintenance Tracker</h1>
    <div class="summary">
      <div class="odometer-section">
        <label>ODO:</label>
        <button id="currentOdometerBtn" class="odometer-btn">
          <span id="odometerValue">0</span>
          <span class="edit-icon">✎</span>
        </button>
      </div>
      <div id="totalCost" class="total-cost">Total 0</div>
    </div>
  </header>

  <main>
    <!-- Duplicate Digital ID removed -->

    <section class="sessions">
      <h2>Maintenance Sessions</h2>

      <!-- Search and Filter Controls -->
      <div class="search-controls">
        <div class="search-group">
          <input type="text" id="sessionSearch" placeholder="Search by date, category, or item/service...">
          <button id="clearSearchBtn" class="clear-search-btn">✕</button>
        </div>
        <div class="filter-group">
          <select id="categoryFilter">
            <option value="">All Categories</option>
          </select>
          <select id="dateFilter">
            <option value="">All Time</option>
            <option value="last30">Last 30 Days</option>
            <option value="last90">Last 90 Days</option>
            <option value="thisYear">This Year</option>
          </select>
        </div>
      </div>

      <!-- Session List with Pagination -->
      <div class="sessions-container">
        <div id="sessionsList"></div>

        <!-- Pagination Controls -->
        <div class="pagination-controls" id="paginationControls" style="display: none;">
          <button id="prevPageBtn" class="pagination-btn">← Previous</button>
          <span id="pageInfo" class="page-info">Page 1 of 1</span>
          <button id="nextPageBtn" class="pagination-btn">Next →</button>
        </div>
      </div>
    </section>

    <section class="upcoming">
      <h2>Digital ID</h2>
      <div class="digital-id-content">
        <div id="carInfoCard" class="car-info-card">
          <button class="edit-car-info-btn" onclick="openCarInfoModal()" title="Edit Car Info">✎</button>
          <div class="car-info-header">
            <div class="live-time" id="liveTime"></div>
          </div>
          <div class="car-info-body">
            <div class="car-info-main">
              <div class="car-info-item">
                <span class="car-info-label">Manufacturer</span>
                <span id="carManufacturer" class="car-info-value">—</span>
              </div>
              <div class="car-info-item">
                <span class="car-info-label">Model</span>
                <span id="carModel" class="car-info-value">—</span>
              </div>
              <div class="car-info-item">
                <span class="car-info-label">Year</span>
                <span id="carYear" class="car-info-value">—</span>
              </div>
              <div class="car-info-item">
                <span class="car-info-label">Plate Number</span>
                <span id="carPlate" class="car-info-value">—</span>
              </div>
            </div>
            <div class="license-expiry-box" id="licenseExpiryBox">
              <span class="license-label">License Expiry</span>
              <span id="carLicenseExpiry" class="license-value">—</span>
            </div>
          </div>
        </div>
        <div class="upcoming-maintenance-container">
          <div id="upcomingList"></div>
          <div id="completedList" style="display: none;">
            <h3>Recently Completed</h3>
            <div id="completedItems"></div>
          </div>
          <button id="toggleCompletedBtn" class="small-btn" style="margin-top: 12px;">Show Recently Completed</button>
        </div>
      </div>
    </section>

    <section class="charts-section">
      <h2>Spending</h2>
      <div class="chart-controls">
        <button id="monthlyView" class="chart-btn active">Monthly</button>
        <button id="yearlyView" class="chart-btn">Yearly</button>
        <select id="spendingMonthFilter" class="chart-filter-select" style="display: none;">
          <option value="">All Months</option>
        </select>
        <select id="spendingYearFilter" class="chart-filter-select" style="display: none;">
          <option value="">All Years</option>
        </select>
      </div>
      <div class="charts-row">
        <div class="chart-card">
          <h3 class="chart-title">Spending Over Time</h3>
          <canvas id="spendingChart"></canvas>
        </div>
        <div class="chart-card">
          <h3 class="chart-title">Spending by Category</h3>
          <canvas id="categoryChart"></canvas>
        </div>
      </div>
    </section>
  </main>

  <button id="newSessionBtn" class="floating-btn">＋</button>
  <button id="settingsBtn" class="floating-btn secondary" style="right: 90px;">⚙</button>


  <!-- Odometer Edit Modal -->
  <div id="odometerModal" class="modal">
    <div class="modal-content small-modal">
      <span id="closeOdometerModal" class="close">&times;</span>
      <h2>Update ODO</h2>
      <div class="form-group">
        <label for="odometerInput">ODO (km):</label>
        <input type="number" id="odometerInput" placeholder="Enter odometer reading" />
      </div>
      <div class="actions">
        <button id="saveOdometerBtn" class="primary-btn">Save</button>
        <button id="cancelOdometerBtn" class="secondary-btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal">
    <div class="modal-content large-modal">
      <span id="closeSettingsModal" class="close">&times;</span>
      <h2>Settings</h2>

      <!-- Category Management Section -->
      <div class="settings-section">
        <h3>Category Management</h3>
        <div class="settings-group">
          <div class="form-group">
            <label for="newCategoryName">Category Name:</label>
            <input type="text" id="newCategoryName" placeholder="Enter category name">
          </div>

          <div class="form-group">
            <label for="newCategoryColor">Category Color:</label>
            <input type="color" id="newCategoryColor" value="#87CEEB">
          </div>

          <button id="addCategoryBtn" class="primary-btn">Add Category</button>
        </div>

        <div id="categoriesList" class="categories-list"></div>
      </div>

      <!-- Data Management Section -->
      <div class="settings-section">
        <h3>Data Management</h3>
        <div class="settings-group">
          <button id="exportDataBtn" class="primary-btn">Export Data (JSON)</button>
          <button id="importDataBtn" class="primary-btn">Import Data (JSON)</button>
          <input type="file" id="importFileInput" accept=".json" style="display: none;">
        </div>
      </div>

      <!-- Danger Zone Section -->
      <div class="settings-section">
        <h3>Danger Zone</h3>
        <div class="settings-group">
          <button id="resetAllDataBtn" class="danger-btn">Reset All Data</button>
          <p class="warning-text">⚠️ This will permanently delete all sessions, items, and categories. This action
            cannot be undone!</p>
        </div>
      </div>
    </div>
  </div>

  <!-- View Details Modal -->
  <div id="viewDetailsModal" class="modal">
    <div class="modal-content">
      <span id="closeViewDetailsModal" class="close">&times;</span>
      <h2>Session Details</h2>
      <div id="sessionDetailsContent"></div>
      <div class="actions">
        <button id="closeViewDetailsBtn" class="secondary-btn">Close</button>
      </div>
    </div>
  </div>

  <!-- Car Info Modal -->
  <div id="carInfoModal" class="modal">
    <div class="modal-content small-modal">
      <span id="closeCarInfoModal" class="close">&times;</span>
      <h2>Car Information</h2>
      <div class="form-group">
        <label for="carManufacturerInput">Manufacturer:</label>
        <input type="text" id="carManufacturerInput" placeholder="e.g., Toyota, Honda, BMW">
      </div>
      <div class="form-group">
        <label for="carModelInput">Model:</label>
        <input type="text" id="carModelInput" placeholder="e.g., Camry, Civic, 3 Series">
      </div>
      <div class="form-group">
        <label for="carYearInput">Year:</label>
        <input type="number" id="carYearInput" placeholder="e.g., 2020" min="1900" max="2100">
      </div>
      <div class="form-group">
        <label for="carPlateInput">Plate Number:</label>
        <input type="text" id="carPlateInput" placeholder="e.g., ABC-1234">
      </div>
      <div class="form-group">
        <label for="carColorInput">Car Color:</label>
        <input type="color" id="carColorInput" value="#1e40af">
      </div>
      <div class="form-group">
        <label for="carLicenseExpiryInput">License Expiry Date:</label>
        <input type="date" id="carLicenseExpiryInput">
      </div>
      <div class="actions">
        <button id="saveCarInfoBtn" class="primary-btn">Save</button>
        <button id="cancelCarInfoBtn" class="secondary-btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div id="sessionModal" class="modal">
    <div class="modal-content">
      <span id="closeModal" class="close">&times;</span>
      <h2>New Maintenance Session</h2>

      <div class="form-group">
        <label>Date:</label>
        <input type="date" id="sessionDate">
      </div>

      <div class="form-group">
        <label>ODO (km):</label>
        <input type="number" id="sessionOdometer">
      </div>

      <div class="form-group">
        <label>Merchant/Place:</label>
        <input type="text" id="sessionMerchant" placeholder="Optional">
      </div>

      <div class="form-group">
        <label>Notes:</label>
        <textarea id="sessionNotes" placeholder="Optional"></textarea>
      </div>

      <h3>Items / Services</h3>
      <div id="itemsContainer"></div>
      <button id="addItemBtn" class="small-btn">Add Item</button>

      <div class="actions">
        <button id="saveSessionBtn" class="primary-btn">Save Session</button>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
</body>

</html>